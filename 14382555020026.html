<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	ORACLE 11G R2静默安装，配置 - Leion's Blog
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="Leion's Blog" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
					<div class="profilepic">
						<img src="asset/icon.jpg" style="width:160px;">
					</div>
					<h1><a href="index.html">Leion's Blog</a></h1>
					<p class="subtitle"></p>
					<nav id="main-nav">
						<ul class="main">
							<li><a href="index.html">Home</a></li>
						    <!-- <li><a href="all.html">Blog</a></li>-->	
						    <li><a href="archives.html">Archives</a></li>
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<!-- 
			<a class="email" href="mailto:" title="Email">Email</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
			<a class="google" href="https://plus.google.com/" rel="author" title="Google+">Google+</a>
			<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
			<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
			<a class="coderwall" href="https://coderwall.com/" title="Coderwall">Coderwall</a>
		    <a class="stackoverflow" href="http://stackoverflow.com/users/" title="StackOverflow"></a>
			<a class="linkedin" href="http://www.linkedin.com/in/" title="LinkedIn">LinkedIn</a>
			<a class="pinterest" href="https://pinterest.com/" title="Pinterest">Pinterest</a>
			<a class="delicious" href="http://delicious.com/" title="Delicious">Delicious</a>
			<a class="pinboard" href="https://pinboard.in/u:" title="Pinboard">Pinboard</a>
			<a class="douban" href="https://www.douban.com/people/" title="Douban">Douban</a>
			<a class="quora" href="https://quora.com/" title="Quora">Quora</a>
			<a class="instagram" href="https://instagram.com/" title="Instagram">Instagram</a>
			<a class="behance" href="https://www.behance.net/" title="Behance">Behance</a>
			<a class="facebook" href="http://www.facebook.com/" title="Facebook">Facebook</a>
								<a class="twitter" href="http://twitter.com/" title="Twitter">Twitter</a>
								<a class="github" href="https://github.com/" title="GitHub">GitHub</a>
-->	
								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">ORACLE 11G R2静默安装，配置</h1>
		<div class="entry-content" itemprop="articleBody">
			<h2 id="toc_0">目录</h2>

<ul>
<li>
<a href="#toc_0">目录</a>
</li>
<li>
<a href="#toc_1">准备工作</a>
</li>
<li>
<a href="#toc_2">开始安装</a>
</li>
<li>
<a href="#toc_3">安装后工作</a>
<ul>
<li>
<ul>
<li>
<a href="#toc_4">建库</a>
</li>
<li>
<a href="#toc_5">配置监听</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_6">测试</a>
</li>
<li>
<a href="#toc_7">自启动脚本</a>
</li>
</ul>


<h2 id="toc_1">准备工作</h2>

<ol>
<li>依赖性准备</li>
</ol>

<blockquote>
<p>root用户执行</p>
</blockquote>

<pre><code>yum install make gcc binutils gcc-c++ compat-libstdc++ elfutils-libelf-devel elfutils-libelf-devel-static ksh libaio libaio-devel numactl-devel sysstat unixODBC unixODBC-devel pcre-devel glibc.i686
</code></pre>

<ol>
<li>用户和组准备</li>
</ol>

<blockquote>
<p>root用户执行</p>
</blockquote>

<pre><code>groupadd oinstall
groupadd dba
useradd -g oinstall -G dba -d /home/oracle oracle
passwd oracle          #设置oracle密码
</code></pre>

<ol>
<li>目录准备及权限调整</li>
</ol>

<blockquote>
<p>root用户执行</p>
</blockquote>

<pre><code>mkdir -p /opt/oracle/product/11g        # 数据库系统安装目录
mkdir /home/oracle/data/oradata         # 数据库数据安装目录
mkdir /home/oracle/data/oradata_back    #数据备份目录
mkdir /home/oracle/inventory            #清单目录
chown -R oracle:oinstall /opt/oracle/product/11g
chown -R oracle:oinstall /home/oracle/inventory
chown -R oracle:oinstall /export/data
chomod -R 775 /opt/oracle
chomod -R 775 /home/oracle/data
</code></pre>

<ol>
<li>内核参数调整</li>
</ol>

<blockquote>
<p>root用户执行</p>
</blockquote>

<p>在文件最后增加 <code>vim /etc/sysctl.conf</code></p>

<pre><code>fs.aio-max-nr = 1048576
fs.file-max = 6553600
kernel.shmall = 2097152
kernel.shmmax = 2147483648
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 1024 65000
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048586
</code></pre>

<p>让参数生效 <code>/sbin/sysctl -p</code> </p>

<ol>
<li>用户的限制文件修改</li>
</ol>

<blockquote>
<p>root用户执行</p>
</blockquote>

<p>在 <code>/etc/security/limits.conf</code> 文件后增加</p>

<pre><code>oracle           soft    nproc           2047
oracle           hard    nproc           16384
oracle           soft    nofile          1024
oracle           hard    nofile          65536
oracle           soft    stack           10240
</code></pre>

<p>修改/etc/pam.d/login文件，增加如下：</p>

<pre><code>session     required    /lib64/security/pam_limits.so  //64为系统，千万别写成/lib/security/pam_limits.so，否则导致无法登录
session     required    pam_limits.so
</code></pre>

<p>修改 <code>/etc/profile</code> 增加</p>

<pre><code class="language-shell">if [ $USER = &quot;oracle&quot; ]; then
    if [ $SHELL = &quot;/bin/ksh&quot; ]; then
        ulimit -p 16384
        ulimit -n 65536
    else
        ulimit -u 16384 -n 65536
    fi
fi
</code></pre>

<ol>
<li>oracle安装包准备</li>
</ol>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<p>下载并解压安装包到 /home/oracle/database</p>

<h2 id="toc_2">开始安装</h2>

<ol>
<li><p>打开另外一个终端，用oracle用户登录</p></li>
<li><p>备份应答文件</p></li>
</ol>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<pre><code>cp -R /home/oracle/database/response/db_install.rsp  /home/oracle/database/response/my_db_install.rsp 
</code></pre>

<ol>
<li>修改应答文件</li>
</ol>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<p>按实际情况修改以下项 <code>/home/oracle/database/response/my_db_install.rsp</code></p>

<pre><code>oracle.install.option=INSTALL_DB_SWONLY
ORACLE_HOSTNAME=oracle11g.jd.com
UNIX_GROUP_NAME=oinstall
INVENTORY_LOCATION=/home/oracle/inventory/
ORACLE_HOME=/export/servers/oracle/11.2.0
ORACLE_BASE=/export/servers/oracle
oracle.install.db.InstallEdition=EE
oracle.install.db.isCustomInstall=false
oracle.install.db.DBA_GROUP=dba
oracle.install.db.OPER_GROUP=dba
DECLINE_SECURITY_UPDATES=true
</code></pre>

<ol>
<li>根据应答文件，开始安装</li>
</ol>

<pre><code>sudo su - oracle
cd /home/oracle/database/
./runInstaller -silent -responseFile /home/oracle/database/response/my_db_install.rsp
</code></pre>

<ol>
<li>按提示切换到root用户的终端，依次执行脚本</li>
</ol>

<blockquote>
<p>root用户执行</p>
</blockquote>

<pre><code>/home/oracle/inventory/orainstRoot.sh
/opt/oracle/11.2.0/root.sh
</code></pre>

<ol>
<li><p>切换到oracle用户的终端，敲”回车“，完成安装</p></li>
<li><p>修改oracle用户环境变量</p></li>
</ol>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<p>修改 <code>~/.bash_profile</code> 添加以下内容</p>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<pre><code>export ORACLE_SID=orcl
export ORACLE_BASE=/app/server/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
PATH=$PATH:$ORACLE_HOME/bin
</code></pre>

<p>7.执行 <code>$source ~/.bash_profile</code> 刷新环境变量</p>

<h2 id="toc_3">安装后工作</h2>

<h4 id="toc_4">建库</h4>

<p>1.复制并修改建库应答文件</p>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<p>复制应答文件</p>

<pre><code>cp -R /home/oracle/database/response/dbca.rsp  /home/oracle/database/response/my_dbca.rsp
</code></pre>

<p>修改应答文件 <code>/home/oracle/database/response/my_dbca.rsp</code></p>

<pre><code>#修改以下项
OPERATION_TYPE = &quot;createDatabase&quot;
GDBNAME = &quot;orcl11g&quot;
SID = &quot;orcl&quot;
SYSPASSWORD = &quot;OraPwd11&quot;
SYSTEMPASSWORD = &quot;OraPwd11&quot;
DATAFILEDESTINATION = /app/data/oradata
RECOVERYAREADESTINATION = /app/data/oradata_back
SYSDBAUSERNAME = &quot;system&quot;
SYSDBAPASSWORD = &quot;OraPwd11&quot;
#以上2项可选
INSTANCENAME = &quot;orcl11g&quot;
CHARACTERSET = &quot;ZHS16GBK&quot; #按需求设置，建议使用UTF-8
NATIONALCHARACTERSET= &quot;&quot; #可选 &quot;UTF8&quot; or &quot;AL16UTF16&quot; 建议UTF-8
TOTALMEMORY = &quot;5120&quot; #Oracle使用的最大内存，单位M建库
</code></pre>

<p>修改好的应答文件，保存在 /vagrant/zhs16gbk/dbca.rsp 文件中，可直接使用。</p>

<p>2.使用dbca静默建库</p>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<pre><code>dbca -silent -responseFile /vagrant/zhs16gbk/dbca.rsp
</code></pre>

<h4 id="toc_5">配置监听</h4>

<ol>
<li>使用netca静默方式创建监听</li>
</ol>

<pre><code>netca /silent /responsefile /vagrant/zhs16gbk/netca.rsp
</code></pre>

<blockquote>
<p>如果netca报错 <strong>netca: line 178: 11819 Aborted $JRE -mx64M $JRE_OPTIONS -classpath $CLASSPATH oracle.net.ca.NetCA $*</strong> 的错误请按照以下步骤修复<br/>
修改2处</p>
</blockquote>

<p><code>cat /etc/sysconfig/network</code></p>

<pre><code>NETWORKING=yes
HOSTNAME=orcl11g
</code></pre>

<p><code>cat /etc/hosts</code></p>

<pre><code># Do not remove the following line, or various programs

# that require network functionality will fail.

127.0.0.1  localhost.localdomain localhost orcl11g
</code></pre>

<p><code>hostname DB11g</code></p>

<blockquote>
<p>让oracle用户退出重新登录就可以正常启动netca了。</p>
</blockquote>

<p>执行完成会在 $ORACLE_HOME/network/admin目录下生成sqlnet.ora和listener.ora两个文件。</p>

<ol>
<li>注册sid</li>
</ol>

<p>修改 <code>$ORACLE_HOME/network/admin/listener.ora</code> 文件</p>

<p>并在</p>

<pre><code>LISTENER =
    (
        DESCRIPTION_LIST =
        (
            DESCRIPTION =
            (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
            (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521)
        )
    )
)
</code></pre>

<p>之前添加以下内容：</p>

<pre><code>SID_LIST_LISTENER =
(
    SID_LIST =
    (
        SID_DESC = 
        (SID_NAME = orcl)
        (ORACLE_HOME = /app/server/oracle/product/11.2.0/db_1)
        (PROGRAM = extproc)
    )
)
</code></pre>

<ol>
<li>执行<code>lsnrctl reload</code>重启监听</li>
</ol>

<p>4.编辑 <code>/etc/oratab</code> 把 <code>orcl11g:/export/servers/oracle/11.2.0:N</code>的‘N’，改为‘Y’，这样就可以通过<code>dbstart</code>启动此实例，也可以通过<code>dbshut</code>关闭此实例了。</p>

<h2 id="toc_6">测试</h2>

<p>1.查看监听状态</p>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<pre><code>lsnrctl status
</code></pre>

<p>类似以下返回，说明监听状态正常</p>

<pre><code>Service &quot;ORCL&quot; has 1 instance(s).
Instance &quot;orcl11g&quot;, status UNKNOWN, has 1 handler(s) for this service...
Service &quot;db1&quot; has 1 instance(s).
Instance &quot;orcl11g&quot;, status READY, has 1 handler(s) for this service...
Service &quot;orcl11gXDB&quot; has 1 instance(s).
Instance &quot;orcl11g&quot;, status READY, has 1 handler(s) for this service...
</code></pre>

<p>2.sqlplus连接测试</p>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<pre><code>export $ORACLE_SID=orcl11g
sqlplus / as sysdba
</code></pre>

<p>正常登陆说明实例正常启动。</p>

<h2 id="toc_7">自启动脚本</h2>

<p>加入 /etc/init.d/oracledb 文件：</p>

<pre><code class="language-bash">
#!/bin/sh -e

# chkconfig: 3 56 10
# description: Oracle 11g custom start/stop script

DAEMON=oracle
ORACLE_HOME=/app/server/oracle/product/11.2.0/db_1
ORACLE_OWNER=oracle

restart()
{
    stop
    start
}

case $1 in
    &#39;start&#39;)
        su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/lsnrctl start&quot;
        su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/dbstart ${ORACLE_HOME}&quot;
        #su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/emctl start dbconsole&quot;
        #su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/isqlplusctl start&quot;
    ;;
    &#39;stop&#39;)
        #su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/isqlplusctl stop&quot;
        #su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/emctl stop dbconsole&quot;
        su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/dbshut ${ORACLE_HOME}&quot;
        su - ${ORACLE_OWNER} -c &quot;${ORACLE_HOME}/bin/lsnrctl stop&quot;
    ;;
    restart)
        restart
    ;;
    *)
        echo &quot;Usage: $0 {start|stop}&quot;
        exit
    ;;
esac

exit $?
</code></pre>

<p>加入自动启动:</p>

<blockquote>
<p>oracle用户执行</p>
</blockquote>

<pre><code>sudo chkconfig --add oracledb
</code></pre>

		</div>
	</article>
	<div class="share-comment">
	
	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

<script src="asset/flow-sequence-chart/raphael-min.js"></script><script src="asset/flow-sequence-chart/underscore-min.js"></script><script src="asset/flow-sequence-chart/flowchart.min.js"></script><script src="asset/flow-sequence-chart/sequence-diagram-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"><div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"><div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/x-mathjax-config">if (typeof MathJaxListener !== 'undefined') { MathJax.Hub.Register.StartupHook('End', function () { MathJaxListener.invokeCallbackForKey_('End'); }); } </script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
</html>